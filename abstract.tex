\begin{abstract}
  Verifying whether a procedure is \emph{observationally pure} 
  (that is, it always returns the same result for the same input argument)
  is challenging when the procedure uses mutable (private) global variables,
  e.g., for memoization, and when the procedure is recursive.

  We present a deductive verification approach for this problem. Our approach
  encodes the procedure's code as a logical formula, with recursive calls being
  modeled using a mathematical function symbol \emph{assuming that the
  procedure is observationally pure}. Then, a theorem prover is invoked to
  check whether this logical formula agrees with the
  function symbol referred to above in terms of input-output behavior for all arguments.
  We prove the soundness of this approach.

  We then present a conservative approximation of the first approach that reduces
  the verification problem to one of checking whether a quantifier-free formula
  is satisfiable and prove the soundness of the second approach.
  %% Key to making this idea work is a
  %% user-provided invariant, which is used as an ``assume'' 
  %% at the points just after the recursive calls, and which summarizes the
  %% possible values that could have been assigned to the global variables
  %% within the recursive calls. In order to make it easy to construct this
  %% invariant, we allow the invariant itself to also refer to the function
  %% symbol referred to above if necessary. 

  We evaluate our approach on a set of realistic examples, using the Boogie
  intermediate language and theorem prover. Our evaluation shows that the
  invariants are easy to construct manually, and that our approach is
  effective at verifying observationally pure procedures.
\end{abstract}
